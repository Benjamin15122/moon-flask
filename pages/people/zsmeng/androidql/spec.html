
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>The AndroidQL Specification &#8212; AndroidQL 1.0 documentation</title>
    <link rel="stylesheet" href="_static/pyramid.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="AndroidQL的使用展示" href="start.html" />
    <link rel="prev" title="&lt;no title&gt;" href="adapter.html" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head><body>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="start.html" title="AndroidQL的使用展示"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="adapter.html" title="&lt;no title&gt;"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">AndroidQL 1.0 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="the-androidql-specification">
<span id="the-androidql-specification"></span><h1>The AndroidQL Specification<a class="headerlink" href="#the-androidql-specification" title="Permalink to this headline">¶</a></h1>
<p><strong>by: mzs</strong></p>
<ul class="simple">
<li><a class="reference external" href="#中文">中文</a><ul>
<li><a class="reference external" href="#AndroidQL的使用">AndroidQL的使用</a></li>
<li><a class="reference external" href="#AndroidQL协议规范">AndroidQL通信协议</a></li>
</ul>
</li>
<li><a class="reference external" href="#English">English</a></li>
<li><a class="reference external" href="#Releases">AndroidQL releases</a></li>
</ul>
<p></p>
<div class="section" id="">
<span id="id1"></span><h2>中文<a class="headerlink" href="#" title="Permalink to this headline">¶</a></h2>
<p><strong>AndroidQL</strong>是一个基于Android Runtime虚拟机开发的可扩展的Android应用测试和分析的框架，它由aql-vm和aql-client俩个独立的部分组成(在文档中，aql，Aql，AQL均是<strong>AndroidQL</strong>可能存在的名称)，支持用户使用预定义的操作快速开发自己的测试和分析脚本，同时也支持更高级的插件扩展.</p>
<p>在本篇规范中，会涉及到以下的概念.</p>
<ul class="simple">
<li><strong>agent</strong>: 每一个Android device抽象成一个<strong>AndroidQL agent</strong></li>
<li><strong>client</strong>: 正在运行且进行<strong>AQL通信</strong>的Android app就是一个<strong>AndroidQL client</strong></li>
<li><strong>VM</strong>: <strong>AndroidQL</strong>修改了Android Runtime也就是ART虚拟机部分源码，因此，下文中提到的VM除非特别说明均是指aql-cm项目中实现的<strong>custom ART</strong>虚拟机</li>
<li><strong>probe</strong>: <strong>AndroidQL</strong>支持的可扩展插件，实现在VM内部，可以对程序运行状态执行<strong>W/R</strong>操作通常配合java客户端来进行使用，<strong>AndroidQL</strong>提供了一些常用的probe，当然用户也可以根据需要来扩展实现更多的probe</li>
<li><strong>通信</strong>: <strong>AndroidQL</strong>中指aql-vm和aql-client之间的通信，该信道复用<strong>ADB</strong>工具管理，通常状况下用户不需要对通信进行任何的设置</li>
<li><strong>table</strong>: probe中用来存储运行时数据的数据结构，支持查询删除插入等操作</li>
</ul>
<div class="section" id="androidqlprobe">
<span id="androidqlprobe"></span><h3><strong>AndroidQL</strong>已实现的的probe<a class="headerlink" href="#androidqlprobe" title="Permalink to this headline">¶</a></h3>
<p><strong>AndroidQL</strong>已经实现完成了一些probe, 它们包括</p>
<ol class="simple">
<li><strong>aql</strong>: aql-vm在VM中实现的probe，扮演着probe manager的角色，VM中其他probe均是它的管理对象，来自aql-client的部分操作请求会被<strong>aql probe</strong>接收，从而对其他所有probe的状态进行有效的管理，这里之所以把它定义为一个probe，一方面是因为<strong>AndroidQL</strong>本身就是probe-base的，另一方面，<strong>AndroidQL</strong>中预定义的几种操作往往需要显示地指定目标probe，但是部分操作是无法指定目标的，比如需要通过某个操作(<strong>TOGGLE</strong>)打开一个probe时，此时请求的数据包被aql-client发送到aql-vm，但是该目标probe在数据包到达时并没有启动，当然无法接收并处理这个操作. 此时，使用<strong>aql</strong>模块完成响应是一个可选的实现方式，因此，<strong>aql</strong> probe在aql-vm中是一个相对特殊的probe，主要对其他probe的状态进行维护，事实上，aql这个特殊的probe负责一切核心的功能，包括通信维护，数据包分发处理，probe池的管理等</li>
<li><strong>brv</strong>: 实现断点逻辑帮助用户劫持(hijack)Android应用的运行过程</li>
<li><strong>mcov, bcov, icov</strong>: 帮助统计测试需要的覆盖率, 包括method, branch, instruction三种级别的覆盖率统计</li>
<li><strong>gui</strong>: 辅助进行gui测试，查询当前的layout数据，执行常用的GUI操作</li>
<li><strong>excp</strong>: 可在程序运行过程中任何时刻模拟抛出特定类型的异常，配合<strong>brk</strong>使用，可以在某些特定方法执行过程中抛出异常</li>
</ol>
<p>通常情况下，完成一份完整的测试或者分析工作事是需要多个probe的协作的，<strong>AndroidQL</strong>支持probe的扩展，用户可以自定义添加更多probe，每一个probe可以完成一个或者多个分析功能. probe的实现可以参考另一篇文档<em><strong>如何实现一个AndroidQL probe</strong></em></p>
</div>
<div class="section" id="androidqljavaaql-client">
<span id="androidqljavaaql-client"></span><h3>AndroidQL框架java客户端aql-client的使用<a class="headerlink" href="#androidqljavaaql-client" title="Permalink to this headline">¶</a></h3>
<div class="section" id="demo-hijackapp">
<span id="demo-hijackapp"></span><h4>一个demo：如何hijack一个app的运行<a class="headerlink" href="#demo-hijackapp" title="Permalink to this headline">¶</a></h4>
<p>该demo展示如何方便地使用AndroidQL<strong>启动一个Android应用并且劫持程序的运行过程</strong></p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>&gt; INSTALL a.apk
&gt; LAUNCH a.apk brk
&gt; BREAKPOINT SET org.demo.MainActivitty:demoActivtiy:0
&gt; PERFORM gui.CLICK <span class="o">(</span><span class="m">345</span>, <span class="m">678</span><span class="o">)</span>
<span class="o">[</span>...<span class="o">]</span> Breakpoint Hit, Suspend
</pre></div>
</div>
<p>demo中初步使用到了<strong>AndroidQL</strong>定义的几种操作(<strong>INSTALL</strong>，<strong>LAUNCH</strong>，<strong>BREAKPOINT</strong>，<strong>PERFORM</strong>). <strong>INSTALL</strong>和<strong>LAUNCH</strong>操作帮助用户安装并且启动一个全新的Android应用，同时在程序启动时开启<strong>brk</strong>这个probe. 接下来通过<strong>BREAKPOINT</strong>操作，可以在MainActivity的demoActivity方法的入口设置了一个断点(方法入口的指令偏移为0)，这样当程序执行到该位置时，应用进程就暂停在该点. 这个操作可以帮助用户执行一些类似于debug的功能，比如在某些特定的情境下，可以方便地hijack程序运行的过程，插入一些park/sleep操作，从而实现一个粗粒度的线程调度器，去做并发相关的测试. 事实上，breakpoint这一利器可以帮助实现几乎所有的<strong>GUIDED</strong>的逻辑.</p>
</div>
<div class="section" id="androidql">
<span id="androidql"></span><h4>AndroidQL接口<a class="headerlink" href="#androidql" title="Permalink to this headline">¶</a></h4>
<p><strong>AndroidQL</strong>提供包括以上提及的4种操作在内的<strong>8</strong>种操作类型(其余4种分别为<strong>TOGGLE</strong>, <strong>RESUME</strong>, <strong>SELECT</strong>, <strong>HIT</strong>)，其中<strong>HIT</strong>作为一种内部特殊的操作，并不开放给用户使用，关于它的更多介绍会在下文提及，这里提到它更多是基于形式统一的考虑. <strong>AndroidQL</strong>定义的<strong>8</strong>种操作类型包括:</p>
<ul class="simple">
<li><strong>INSTALL</strong>: 安装app</li>
<li><strong>LAUNCH</strong>: 启动app</li>
<li><strong>TOGGLE</strong>: 打开／关闭一个probe</li>
<li><strong>PERFORM</strong>: 执行用户定义的操作，比如UI操作，throw exception等</li>
<li><strong>BREAKPOINT</strong>: 设置断点，suspend程序的运行</li>
<li><strong>HIT</strong>: 特殊操作，通知aql-client当前测试程序已运行至某个断点，app进程当前已被suspend</li>
<li><strong>RESUME</strong>: 恢复程序运行</li>
<li><strong>SELECT</strong>: 查询操作，主要用来查询运行时数据</li>
</ul>
<p>一个可执行的<strong>AndroidQL</strong>操作是由以上任意一种操作类型加一些特定形式的参数组成的，通常来说，一个可执行的<strong>AndroidQL</strong>语句是这样的：</p>
<blockquote>
<div><strong>INSTALL</strong> | <strong>LAUNCH</strong> | <strong>PERFORM</strong> | <strong>BREAKPOINT</strong> | <strong>RESUME</strong> | <strong>SELECT</strong> [probe.action] [args] [from probe.table] [args]</div></blockquote>
<p><strong>probe.action</strong>的书写形式表明，一个实现在VM中的probe可以注册一些感兴趣的action列表，从而对外部的某些行为(比如click)产生响应，而<strong>probe.table</strong>从另一个角度表明一个probe可以在内存中实现很多的table，用来存储运行时产生的数据(比如当前覆盖到的所有方法). VM中可能同时存在上百个probe，因此理论上在AndroidQL的所有操作中，都需要唯一地指定目标probe，这样该指令会被VM部分的核心运行逻辑(<strong>aql</strong> probe)分发至对应的probe模块进行处理. 然而在具体实现上，<strong>AndroidQL</strong>针对不同的操作进行了一些特殊化的处理，也就是说不是所有的使用情境下，都需要指定目标probe.</p>
<p><strong>AndroidQL</strong>的运行机制设定所有probe均存在于VM中，probe注册感兴趣的action，同时对每一个action注册执行处理逻辑的handler. 所有来自aql-client的操作都会被分装成格式化的数据包，通过<strong>AndroiQL</strong>的通信机制发送给aql-vm，VM根据数据包中的目标probe对操作进行分发，由目标probe完成实际的数据处理和响应.</p>
<p>VM在app启动时被动态地创建，在<strong>INSTALL</strong>指令执行时，app并没有被启动，因此，<strong>INSTALL</strong>指令无需显示地指定目标probe. 此外，<strong>LAUNCH</strong>操作用来启动app创建VM，在它被aql-vm响应前，VM也并没有启动，因此它也不需要指定probe. 而<strong>BREAKPOINT</strong>的所有实现逻辑都天然地绑定在<strong>brk</strong>这个probe内，也不再需要对目标probe进行显示的指定. 在<strong>AndroidQL</strong>的设计中，只有<strong>PERFORM</strong>，<strong>TOGGLE</strong>，<strong>SELECT</strong>三种操作是需要指定probe的.</p>
<p>总结一下，需要目标probe参数的操作和无需指定probe的操作是这样区分的:</p>
<ul class="simple">
<li>需要指定probe: <strong>TOGGLE</strong>, <strong>PERFORM</strong>，<strong>SELECT</strong></li>
</ul>
<p>并不是所有的<strong>AndroidQL</strong>操作类型都需要显示地指定目标probe，然而以上的三种操作在不指定目标probe时，却可能会产生<strong>无法预期的错误</strong>.</p>
<p>接下来，针对不同的<strong>AndroidQL</strong>操作指令格式分别进行详细的介绍.</p>
<div class="section" id="install">
<span id="install"></span><h5>INSTALL<a class="headerlink" href="#install" title="Permalink to this headline">¶</a></h5>
<p><strong>INSTALL</strong>操作格式最为简单，其中apk_path指定要安装的apk的路径，这个路径是指本地apk的路径，需要确保该apk文件存在且可用，否则会导致安装错误的出现.</p>
<blockquote>
<div>INSTALL apk_path</div></blockquote>
</div>
<div class="section" id="launch">
<span id="launch"></span><h5>LAUNCH<a class="headerlink" href="#launch" title="Permalink to this headline">¶</a></h5>
<p>在一些使用情境下，可能需要在启动app的同时伴随开启某些probe，所以<strong>LAUNCH</strong>操作格式如下</p>
<blockquote>
<div>LAUNCH apk_path [probes]</div></blockquote>
<p>在demo中，启动app同时开启了brk这个用来执行breakpoint逻辑的probe模块，我们可以一次开启更多的probe，也可以只是单纯地想启动一个app而已，并不打开任何probe，以上的俩种使用需求可以通过以下的俩个操作完成.</p>
<blockquote>
<div>LAUNCH a.apk brk,mcov</div></blockquote>
<blockquote>
<div>LAUNCH a.apk //不开启任何probe</div></blockquote>
</div>
<div class="section" id="breakpoint">
<span id="breakpoint"></span><h5>BREAKPOINT<a class="headerlink" href="#breakpoint" title="Permalink to this headline">¶</a></h5>
<blockquote>
<div>BREAKPOINT SET/CLEAN class_descriptor:method_name:offset</div></blockquote>
<p><strong>BREAKPOINT</strong>操作可以帮助添加和清除断点，method_name指断点所在方法的方法名，而offset参数指定断点在方法中的偏移，如果想在调用某个方法入口就设置断点，可将offset置于0. 通过这三个参数，<strong>AndroidQL</strong>可以唯一地定位所有的断点.</p>
<blockquote>
<div>BREAKPOINT SET org.aql.doc:demo:0</div></blockquote>
<blockquote>
<div>BREAKPOINT CLEAN org.aql.doc:demo:7</div></blockquote>
</div>
<div class="section" id="hit">
<span id="hit"></span><h5>HIT<a class="headerlink" href="#hit" title="Permalink to this headline">¶</a></h5>
<blockquote>
<div>HIT class:method:offset</div></blockquote>
<p><strong>HIT</strong>操作由VM发起，告诉aql-client进程，当前有断点被响应，返回的数据包括当前app已处于暂停运行的状态以及断点的位置(类限定符，方法名，方法体内指令偏移)等信息.</p>
</div>
<div class="section" id="resume">
<span id="resume"></span><h5>RESUME<a class="headerlink" href="#resume" title="Permalink to this headline">¶</a></h5>
<p><strong>RESUME</strong>指令只有一种形式，它用于恢复VM的运行状态</p>
<blockquote>
<div>RESUME</div></blockquote>
<p>以上的操作类型是<strong>无需指定目标probe</strong>的. 下边介绍<strong>必须指定</strong>probe的<strong>AndroidQL</strong>接口的语法.</p>
</div>
<div class="section" id="toggle">
<span id="toggle"></span><h5>TOGGLE<a class="headerlink" href="#toggle" title="Permalink to this headline">¶</a></h5>
<p><strong>TOGGLE</strong></p>
<p>可以用切换某个probe的运行状态.</p>
<p>因此，打开/关闭一个probe只需要</p>
<blockquote>
<div>TOGGLE probes on/off [probes off/on]</div></blockquote>
<ul class="simple">
<li>TOGGLE icov,brk off ui on</li>
<li>TOGGLE mcov,brk off ui on</li>
<li>TOGGLE mcov on icov off</li>
<li>TOGGLE bcov on</li>
</ul>
</div>
<div class="section" id="proform">
<span id="proform"></span><h5>PROFORM<a class="headerlink" href="#proform" title="Permalink to this headline">¶</a></h5>
<blockquote>
<div>PERFORM probe.action [args]</div></blockquote>
<p><strong>PERFORM</strong>操作的action在满足probe处理逻辑可以响应的条件下可由用户定制添加，当然处理逻辑需要目标probe支持实现. 因此在probe的扩展中，<strong>PERFORM</strong>操作会扮演极其重要的角色. 当前<strong>AndroidQL</strong>已经使用<strong>PERFORM</strong>操作完成实现gui这个probe，来辅助进行GUI方面的测试和分析，注册并支持的action包括</p>
<ul class="simple">
<li>CLICK</li>
<li>LONGCLICK</li>
<li>SWIPE</li>
<li>DOUBLECLICK</li>
<li>MENU</li>
<li>HOME</li>
<li>BACK</li>
<li>UNLOCK</li>
<li>DUMPLAYOUT</li>
</ul>
<p>使用方法如下：</p>
<blockquote>
<div>PERFORM gui.CLICK/gui.LONGCLICK/gui.DOUBLECLICK (x,y)</div></blockquote>
<blockquote>
<div>PERFORM gui.MENU/gui.HOME/gui.BACK/gui.UNLOCK</div></blockquote>
<blockquote>
<div>PERFORM gui.SWIPE (x1,y1) (x2,y2)   //()内无任何空白符</div></blockquote>
<blockquote>
<div>PERFORM gui.DUMPLAYOUT</div></blockquote>
<p>此外，<strong>AndroidQL</strong>使用PERFORM实现完成另外一个probe—<strong>excp</strong>，它可以在程序运行过程任意时刻抛出异常，模拟一些极端的app运行环境，比如配合<strong>excp</strong>和<strong>PERRORM</strong>可以完成抛io异常的操作：</p>
<blockquote>
<div>PERORM excp.THROW java.io.Excption(“Mock exception”)</div></blockquote>
</div>
<div class="section" id="select">
<span id="select"></span><h5>SELECT<a class="headerlink" href="#select" title="Permalink to this headline">¶</a></h5>
<blockquote>
<div>SELECT stmt_body</div></blockquote>
<p>stmt_body除table名前需要用probe.table形式进行唯一的限定外，它本身就是可执行的sql语句。<strong>SELECT</strong>查询操作需要目标probe进行响应，而一个probe的所有table都由该probe自行实现和管理，比如可以把当前的layout实现为<strong>gui</strong>这一probe中的一张表，也可以把当前覆盖到的方法抽象成一张表. 在<strong>AndroidQL</strong>中，<strong>all is table</strong>，这里的all，指的是一个app所有的可读取的运行时数据.</p>
<p>查询所有方法覆盖的指令如下：</p>
<blockquote>
<div>SELECT * from mcov.method_table</div></blockquote>
<p>最后，在<strong>AndroidQL</strong>的实现中，每个probe可以响应什么操作是由用户开发的probe指定的，当然<strong>AndroidQL</strong>原始提供了一些probe完成一些常用的操作，用户完全可以在VM中实现自己的probe，并且实现probe对应的指令响应逻辑.</p>
<p><strong>注</strong>: <strong>所有的AndroidQL操作都是大小写不敏感的</strong>.</p>
<p>行文至此，文档已经可以帮助用户上手使用<strong>AndroidQL</strong>的接口了. 因此，以下的章节主要针对想要进一步了解<strong>AndroidQL通信实现机制</strong>的使用者</p>
</div>
</div>
</div>
<div class="section" id="androidql">
<span id="id2"></span><h3>AndroidQL协议规范<a class="headerlink" href="#androidql" title="Permalink to this headline">¶</a></h3>
<p>AndroidQL数据包格式</p>
<p>| Length | Dataload             |
| ——      | :——————— |
| 4 bytes |  可变长度            |</p>
<ul class="simple">
<li>AndroidQL的格式化数据包用于aql-client和aql-client通信, 数据包分为request和reply俩种，在具体的实现中，这俩种包的格式是基本一致的.</li>
<li>AndroidQL数据包分为头部和数据部分, 头部只包括length一个域，占4个字节，length部分表示全部数据包的字节数，也包括头部在内.</li>
<li>Dataload部分使用JSON格式序列化数据传输.</li>
</ul>
<p>Dataload部分的格式如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="nb">id</span>
    <span class="s2">&quot;probe&quot;</span><span class="p">:</span> <span class="n">probe_name</span><span class="p">,</span>
    <span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="n">cmd_name</span><span class="p">,</span>
    <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="o">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>id用来唯一地区分一个数据包，对某一个request的响应reply包应该使用一致的id取值. probe是预定义在AndroidQL中的目标插件名字，它会对这个数据包进行拆解响应，并且会回复reply数据包给aql-client. cmd指令是指除HIT操作外其余7种操作类型. 当VM执行到预定义的breakpoint时，它会向aql-client发送一个packet通知虚拟机已经执行到对应的断点并暂停app的运行，此时cmd被定义为HIT，因此HIT是一种特殊的操作. 在AndroidQL用来装载request的packet中，cmd一共有8种类型，每种操作对应的data格式是不一样的.</p>
<p><strong>注</strong>: <strong>AndroidQL协议中规定传输过程中所有的字符串都采用小写格式(probe_name除外)</strong>.</p>
<p>不同cmd数据包对应data部分的格式是不尽相同的.</p>
<div class="section" id="install">
<span id="id3"></span><h4>INSTALL<a class="headerlink" href="#install" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="nb">id</span>
   <span class="s2">&quot;probe&quot;</span><span class="p">:</span> <span class="s2">&quot;aql&quot;</span><span class="p">,</span>
   <span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;install&quot;</span><span class="p">,</span>
   <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">path</span><span class="p">:</span> <span class="n">apk_path</span>
   <span class="p">}</span>
</pre></div>
</div>
<p>}</p>
</div>
<div class="section" id="launch">
<span id="id4"></span><h4>LAUNCH<a class="headerlink" href="#launch" title="Permalink to this headline">¶</a></h4>
<p>带有probe启动参数的LANCH语句会由AndroidQL自动封装成LAUNCH和TOGGLE逻辑(并不意味着一定会衍生出附加的TOGGLE数据包)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="nb">id</span>
    <span class="s2">&quot;probe&quot;</span><span class="p">:</span> <span class="s2">&quot;aql&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;launch&quot;</span><span class="p">,</span>
    <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;pkg&quot;</span><span class="p">:</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span>
        <span class="s2">&quot;activity&quot;</span><span class="p">:</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span>
        <span class="s2">&quot;probes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">probe1</span><span class="p">,</span> <span class="n">probe2</span><span class="p">,</span><span class="o">...</span><span class="p">]</span> 
    <span class="p">}</span>
</pre></div>
</div>
<p>}</p>
</div>
<div class="section" id="select">
<span id="id5"></span><h4>SELECT<a class="headerlink" href="#select" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="nb">id</span>
    <span class="s2">&quot;probe&quot;</span><span class="p">:</span> <span class="n">probe_name</span><span class="p">,</span>
    <span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;select&quot;</span><span class="p">,</span>
    <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">stmt</span><span class="p">:</span> <span class="n">executable</span> <span class="n">SQL</span> <span class="n">stmt</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="toggle">
<span id="id6"></span><h3>TOGGLE<a class="headerlink" href="#toggle" title="Permalink to this headline">¶</a></h3>
<p>切换probe(aql是特殊的probe，用作probe manager)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="nb">id</span>
    <span class="s2">&quot;probe&quot;</span><span class="p">:</span> <span class="s2">&quot;aql&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;toggle&quot;</span><span class="p">,</span>
    <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">probe1</span><span class="p">:</span> <span class="s2">&quot;on&quot;</span><span class="p">,</span>
        <span class="n">probe2</span><span class="p">:</span> <span class="s2">&quot;off&quot;</span><span class="p">,</span>
        <span class="o">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="breakponit">
<span id="breakponit"></span><h3>BREAKPONIT<a class="headerlink" href="#breakponit" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="nb">id</span>
    <span class="s2">&quot;probe&quot;</span><span class="p">:</span> <span class="n">probe_name</span><span class="p">,</span>
    <span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;break_point&quot;</span><span class="p">,</span>
    <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="n">class_name</span><span class="p">,</span>
        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">method_signature</span><span class="p">,</span>
        <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="nb">int</span> <span class="n">number</span><span class="p">,</span>
        <span class="s2">&quot;option&quot;</span><span class="p">:</span> <span class="nb">set</span><span class="o">/</span><span class="n">clear</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="resume">
<span id="id7"></span><h3>RESUME<a class="headerlink" href="#resume" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="nb">id</span>
    <span class="s2">&quot;probe&quot;</span><span class="p">:</span> <span class="n">probe_name</span><span class="p">,</span>
    <span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;resume&quot;</span><span class="p">,</span>
    <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="perform">
<span id="perform"></span><h3>PERFORM<a class="headerlink" href="#perform" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="nb">id</span>
    <span class="s2">&quot;probe&quot;</span><span class="p">:</span> <span class="n">probe_name</span><span class="p">,</span>
    <span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;perform&quot;</span><span class="p">,</span>
    <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="n">action_name</span>
        <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="n">args</span> <span class="nb">list</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="hit">
<span id="id8"></span><h3>HIT<a class="headerlink" href="#hit" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="nb">id</span>
    <span class="s2">&quot;probe&quot;</span><span class="p">:</span> <span class="n">probe_name</span><span class="p">,</span>
    <span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;hit&quot;</span><span class="p">,</span>
    <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="n">class_name</span><span class="p">,</span>
            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">method_signature</span><span class="p">,</span>
            <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="nb">int</span> <span class="n">number</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>在<strong>AndroidQL</strong>通信中，所有的request发送之后都要同步的等待reply包的返回(HIT包不在这一规定范围之内).</p>
</div>
<div class="section" id="reply">
<span id="reply"></span><h3>Reply包格式<a class="headerlink" href="#reply" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>{
  &quot;id&quot;: id
  &quot;status&quot;: “fail”/&quot;ok&quot;,
  &quot;data&quot;: {
  }
}
</pre></div>
</div>
</div>
<div class="section" id="perform">
<span id="id9"></span><h3>PERFORM<a class="headerlink" href="#perform" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="nb">id</span>
    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;fail&quot;</span><span class="o">/</span><span class="s2">&quot;ok&quot;</span><span class="p">,</span>
    <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;str&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="english">
<span id="english"></span><h2>English<a class="headerlink" href="#english" title="Permalink to this headline">¶</a></h2>
<div class="section" id="tbd">
<span id="tbd"></span><h3>TBD<a class="headerlink" href="#tbd" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="releases">
<span id="releases"></span><h2>Releases<a class="headerlink" href="#releases" title="Permalink to this headline">¶</a></h2>
<div class="section" id="tbd">
<span id="id10"></span><h3>TBD<a class="headerlink" href="#tbd" title="Permalink to this headline">¶</a></h3>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">The AndroidQL Specification</a><ul>
<li><a class="reference internal" href="#">中文</a><ul>
<li><a class="reference internal" href="#androidqlprobe"><strong>AndroidQL</strong>已实现的的probe</a></li>
<li><a class="reference internal" href="#androidqljavaaql-client">AndroidQL框架java客户端aql-client的使用</a><ul>
<li><a class="reference internal" href="#demo-hijackapp">一个demo：如何hijack一个app的运行</a></li>
<li><a class="reference internal" href="#androidql">AndroidQL接口</a><ul>
<li><a class="reference internal" href="#install">INSTALL</a></li>
<li><a class="reference internal" href="#launch">LAUNCH</a></li>
<li><a class="reference internal" href="#breakpoint">BREAKPOINT</a></li>
<li><a class="reference internal" href="#hit">HIT</a></li>
<li><a class="reference internal" href="#resume">RESUME</a></li>
<li><a class="reference internal" href="#toggle">TOGGLE</a></li>
<li><a class="reference internal" href="#proform">PROFORM</a></li>
<li><a class="reference internal" href="#select">SELECT</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#androidql">AndroidQL协议规范</a><ul>
<li><a class="reference internal" href="#install">INSTALL</a></li>
<li><a class="reference internal" href="#launch">LAUNCH</a></li>
<li><a class="reference internal" href="#select">SELECT</a></li>
</ul>
</li>
<li><a class="reference internal" href="#toggle">TOGGLE</a></li>
<li><a class="reference internal" href="#breakponit">BREAKPONIT</a></li>
<li><a class="reference internal" href="#resume">RESUME</a></li>
<li><a class="reference internal" href="#perform">PERFORM</a></li>
<li><a class="reference internal" href="#hit">HIT</a></li>
<li><a class="reference internal" href="#reply">Reply包格式</a></li>
<li><a class="reference internal" href="#perform">PERFORM</a></li>
</ul>
</li>
<li><a class="reference internal" href="#english">English</a><ul>
<li><a class="reference internal" href="#tbd">TBD</a></li>
</ul>
</li>
<li><a class="reference internal" href="#releases">Releases</a><ul>
<li><a class="reference internal" href="#tbd">TBD</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="adapter.html"
                        title="previous chapter">&lt;no title&gt;</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="start.html"
                        title="next chapter">AndroidQL的使用展示</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/spec.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="start.html" title="AndroidQL的使用展示"
             >next</a> |</li>
        <li class="right" >
          <a href="adapter.html" title="&lt;no title&gt;"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">AndroidQL 1.0 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, mzs.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.1.
    </div>
  </body>
</html>